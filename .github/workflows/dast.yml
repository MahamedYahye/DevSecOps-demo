# name: OWASP ZAP Security Scan

# on:
#     workflow_dispatch:  # Handmatig triggeren
#     push:
#       branches: [ main ]  # Of vervang 'main' door je default branch

# jobs:
#  zap-scan:
#    runs-on: self-hosted  # Gebruik je self-hosted runner
   
#    steps:
#    - name: Checkout code
#      uses: actions/checkout@v4
   
#    - name: Test URL connectivity
#      run: |
#        echo "Testing connection to target URL: http://localhost:8081"
#        if curl -s --head --fail http://localhost:8081 > /dev/null; then
#          echo "✅ Connection successful"
#        else
#          echo "❌ Connection failed - URL is not accessible"
#          echo "Make sure port-forwarding is running with: kubectl port-forward service/flask-app 8081:80"
#          exit 1
#        fi
   
#    - name: Run ZAP Scan
#      run: |
#        echo "Scanning target URL: http://host.docker.internal:8081"
#        mkdir -p zap-report
#        docker run --rm \
#          -v "$(pwd)/zap-report:/zap/wrk" \
#          zaproxy/zap-stable:latest \
#          zap-baseline.py -t http://host.docker.internal:8081 -g gen.conf -r zap-report.html
   
#    - name: Check ZAP result
#      run: |
#        if [ -f "zap-report/zap-report.html" ]; then
#          echo "✅ ZAP scan complete. Results saved to zap-report directory."
#          ls -la zap-report/
#        else
#          echo "❌ ZAP report not found. The scan might have failed."
#          exit 1
#        fi
   
#    - name: Upload ZAP report
#      if: always()  # Upload report even if previous steps failed
#      uses: actions/upload-artifact@v4
#      with:
#        name: zap-report
#        path: zap-report

